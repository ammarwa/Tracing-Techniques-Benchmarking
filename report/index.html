<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>eBPF vs LTTng Comprehensive Benchmark Report</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        .key-finding {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .key-finding h3 {
            margin-top: 0;
            color: #856404;
        }
        .table-wrapper {
            overflow-x: auto;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            min-width: 800px;  /* Prevent table from becoming too narrow */
        }
        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            white-space: nowrap;  /* Prevent text wrapping in cells */
        }
        th {
            background: #3498db;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:hover {
            background: #f8f9fa;
        }
        td:nth-child(1), td:nth-child(2) {
            font-weight: 600;  /* Make scenario and work columns stand out */
        }
        .chart {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .metadata {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .good { color: #27ae60; font-weight: bold; }
        .warning { color: #f39c12; font-weight: bold; }
        .bad { color: #e74c3c; font-weight: bold; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä eBPF vs LTTng Comprehensive Benchmark Report</h1>

        <div class="metadata">
            <strong>Generated:</strong> 2025-10-10 16:28:12<br>
            <strong>Test Scenarios:</strong> 6<br>
            <strong>Function Durations Tested:</strong> 0 Œºs (empty) to 1000 Œºs<br>
            <strong>Runs Per Scenario:</strong> 10 (for statistical reliability)<br>
            <strong>Total Tests Run:</strong> 180
        </div>

        <div class="key-finding">
            <h3>üîë Key Finding: Understanding Per-Call vs Whole Application Overhead</h3>
            <p>eBPF uprobe overhead is approximately <strong>~5 microseconds per function call</strong>, regardless of function duration.</p>

            <p><strong>Per-Call Overhead (Individual Function):</strong></p>
            <ul>
                <li>For nanosecond functions: Overhead appears catastrophic (1000x+)</li>
                <li>For microsecond functions: Overhead is moderate (1-10x)</li>
                <li>For millisecond functions: Overhead is negligible (&lt;1%)</li>
            </ul>

            <p><strong>Whole Application Overhead (Total Execution Time):</strong></p>
            <ul>
                <li>This is what matters in production!</li>
                <li>Measured as the increase in total wall clock time</li>
                <li>Includes all traced calls plus application overhead</li>
                <li>Typically much lower than per-call overhead averages</li>
            </ul>

            <p><strong>Conclusion:</strong> eBPF is perfect for GPU tracing where HIP API calls typically take 10-1000 Œºs! The whole application overhead is typically &lt;5% for realistic workloads.</p>
        </div>

        <h2>üìà Per-Call Overhead by Function Duration</h2>
        <p><em>This chart shows the overhead added to each individual function call.</em></p>
        <div class="chart" id="overhead-chart"></div>

        <h2>üåê Whole Application Overhead</h2>
        <p><em>This chart shows the total overhead impact on the entire application execution time (wall clock time).</em></p>
        <div class="chart" id="app-overhead-chart"></div>

        <h2>‚è±Ô∏è Total Execution Time Comparison</h2>
        <p><em>This chart compares the absolute wall clock time for the entire application run.</em></p>
        <div class="chart" id="wall-time-chart"></div>

        <h2>‚è±Ô∏è Per-Call Timing Comparison</h2>
        <p><em>This chart shows the average time per individual function call.</em></p>
        <div class="chart" id="timing-chart"></div>

        <h2>üìä Detailed Results Table</h2>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Work (Œºs)</th>
                        <th>Method</th>
                        <th>Wall Time (s)</th>
                        <th>App Overhead %</th>
                        <th>Avg Time/Call (ns)</th>
                        <th>¬±95% CI</th>
                        <th>Per-Call Overhead %</th>
                        <th>CPU (s)</th>
                        <th>Memory (KB)</th>
                    </tr>
                </thead>
                <tbody>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>Empty Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">0</td>
                    <td><strong>Baseline</strong></td>
                    <td>3.504</td>
                    <td class="good">0%</td>
                    <td>35074.08</td>
                    <td><small>¬±854.13</small></td>
                    <td class="good">0%</td>
                    <td>3.497</td>
                    <td>1,753</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>3.643</td>
                    <td class="good">4.0%</td>
                    <td>35637.23</td>
                    <td><small>¬±619.07</small></td>
                    <td class="good">1.6%</td>
                    <td>3.632</td>
                    <td>630,214</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>5.631</td>
                    <td class="bad">60.7%</td>
                    <td>56342.39</td>
                    <td><small>¬±7725.31</small></td>
                    <td class="bad">60.6%</td>
                    <td>5.628</td>
                    <td>1,726 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>5 Œºs Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">5</td>
                    <td><strong>Baseline</strong></td>
                    <td>8.257</td>
                    <td class="good">0%</td>
                    <td>82608.38</td>
                    <td><small>¬±843.66</small></td>
                    <td class="good">0%</td>
                    <td>8.252</td>
                    <td>1,696</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>8.105</td>
                    <td class="good">-1.8%</td>
                    <td>80592.03</td>
                    <td><small>¬±1574.45</small></td>
                    <td class="good">-2.4%</td>
                    <td>8.096</td>
                    <td>334,322</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>10.686</td>
                    <td class="warning">29.4%</td>
                    <td>106900.52</td>
                    <td><small>¬±9641.85</small></td>
                    <td class="warning">29.4%</td>
                    <td>10.681</td>
                    <td>1,738 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>50 Œºs Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">50</td>
                    <td><strong>Baseline</strong></td>
                    <td>8.459</td>
                    <td class="good">0%</td>
                    <td>169254.87</td>
                    <td><small>¬±3913.53</small></td>
                    <td class="good">0%</td>
                    <td>8.453</td>
                    <td>1,716</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>8.396</td>
                    <td class="good">-0.7%</td>
                    <td>167097.70</td>
                    <td><small>¬±3493.35</small></td>
                    <td class="good">-1.3%</td>
                    <td>8.387</td>
                    <td>334,292</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>9.916</td>
                    <td class="warning">17.2%</td>
                    <td>198359.52</td>
                    <td><small>¬±11894.58</small></td>
                    <td class="warning">17.2%</td>
                    <td>9.908</td>
                    <td>1,716 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>100 Œºs Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">100</td>
                    <td><strong>Baseline</strong></td>
                    <td>2.637</td>
                    <td class="good">0%</td>
                    <td>263979.97</td>
                    <td><small>¬±5161.92</small></td>
                    <td class="good">0%</td>
                    <td>2.631</td>
                    <td>1,686</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>2.668</td>
                    <td class="good">1.2%</td>
                    <td>262684.34</td>
                    <td><small>¬±4340.52</small></td>
                    <td class="good">-0.5%</td>
                    <td>2.659</td>
                    <td>334,260</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>2.858</td>
                    <td class="good">8.4%</td>
                    <td>286280.07</td>
                    <td><small>¬±7998.56</small></td>
                    <td class="good">8.4%</td>
                    <td>2.854</td>
                    <td>1,708 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>500 Œºs Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">500</td>
                    <td><strong>Baseline</strong></td>
                    <td>3.467</td>
                    <td class="good">0%</td>
                    <td>694438.45</td>
                    <td><small>¬±13153.66</small></td>
                    <td class="good">0%</td>
                    <td>3.464</td>
                    <td>1,722</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>3.575</td>
                    <td class="good">3.1%</td>
                    <td>706373.52</td>
                    <td><small>¬±6178.84</small></td>
                    <td class="good">1.7%</td>
                    <td>3.564</td>
                    <td>334,301</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>3.661</td>
                    <td class="good">5.6%</td>
                    <td>733082.61</td>
                    <td><small>¬±10561.38</small></td>
                    <td class="good">5.6%</td>
                    <td>3.657</td>
                    <td>1,730 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>1000 Œºs (1ms) Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">1000</td>
                    <td><strong>Baseline</strong></td>
                    <td>2.503</td>
                    <td class="good">0%</td>
                    <td>1253589.50</td>
                    <td><small>¬±6250.70</small></td>
                    <td class="good">0%</td>
                    <td>2.497</td>
                    <td>1,739</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>2.574</td>
                    <td class="good">2.8%</td>
                    <td>1265689.59</td>
                    <td><small>¬±5128.33</small></td>
                    <td class="good">1.0%</td>
                    <td>2.562</td>
                    <td>334,320</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>2.547</td>
                    <td class="good">1.8%</td>
                    <td>1275558.21</td>
                    <td><small>¬±11178.18</small></td>
                    <td class="good">1.8%</td>
                    <td>2.541</td>
                    <td>1,713 (app)</td>
                </tr>

                </tbody>
            </table>
        </div>

        <h2>üíæ Resource Usage Comparison</h2>
        <div class="chart" id="memory-chart"></div>

        <h2>üìù Analysis and Recommendations</h2>

        <h3>When to Use Each Method</h3>
        <table>
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Best For</th>
                    <th>Avoid When</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>LTTng</strong></td>
                    <td>
                        ‚Ä¢ Functions > 100ns<br>
                        ‚Ä¢ Can modify app or use LD_PRELOAD<br>
                        ‚Ä¢ Need rich userspace context<br>
                        ‚Ä¢ High call frequency (>10K/sec)
                    </td>
                    <td>
                        ‚Ä¢ Cannot modify application<br>
                        ‚Ä¢ Need kernel-level tracing<br>
                        ‚Ä¢ Want dynamic attach/detach
                    </td>
                </tr>
                <tr>
                    <td><strong>eBPF</strong></td>
                    <td>
                        ‚Ä¢ Functions > 10Œºs<br>
                        ‚Ä¢ Cannot modify application<br>
                        ‚Ä¢ Need kernel visibility<br>
                        ‚Ä¢ Want dynamic attach/detach<br>
                        ‚Ä¢ GPU/HIP API tracing
                    </td>
                    <td>
                        ‚Ä¢ Ultra-fast functions (<1Œºs)<br>
                        ‚Ä¢ Very high frequency (>1M calls/sec)<br>
                        ‚Ä¢ Need real-time streaming
                    </td>
                </tr>
            </tbody>
        </table>

        <h3>GPU/HIP Tracing Recommendation</h3>
        <p>For GPU and HIP API tracing, <strong>eBPF is highly recommended</strong> because:</p>
        <ul>
            <li>HIP API calls typically take 10-1000 Œºs (much slower than uprobe overhead)</li>
            <li>GPU kernel execution takes milliseconds (making tracer overhead negligible)</li>
            <li>No application modification required (zero code changes)</li>
            <li>Can trace at kernel/driver boundary for complete visibility</li>
            <li>Expected total application overhead: <strong>&lt;1%</strong></li>
        </ul>

        <h2>üìö Data Files</h2>
        <p>Raw benchmark data: <code>benchmark_results_20251010_160256/results.json</code></p>
        <p><em>Note: Individual trace files are automatically cleaned up after data extraction to minimize disk usage.</em></p>
    </div>

    <script>
        // Prepare data for charts
        const work_us_data = [0, 5, 50, 100, 500, 1000];
        const lttng_overhead_pct = [1.6056075147924176, -2.440856514083156, -1.274512802647798, -0.49080844477547014, 1.7186641856097307, 0.9652351077757748];
        const ebpf_overhead_pct = [60.63826742007401, 29.406383824575478, 17.19575503383888, 8.44764841308625, 5.564807043361086, 1.7524636996322673];

        const scenario_names = ["Empty Function", "5 \u03bcs Function", "50 \u03bcs Function", "100 \u03bcs Function", "500 \u03bcs Function", "1000 \u03bcs (1ms) Function"];
        const baseline_ns_data = [35074.076, 82608.379, 169254.871, 263979.973, 694438.454, 1253589.504];
        const lttng_total_ns = [35637.228, 80592.027, 167097.696, 262684.337, 706373.519, 1265689.59];
        const ebpf_total_ns = [56342.388, 106900.516, 198359.524, 286280.07300000003, 733082.614, 1275558.205];

        const memory_baseline = [1753, 1696, 1716, 1686, 1722, 1739];
        const memory_lttng = [630214, 334322, 334292, 334260, 334301, 334320];
        const memory_ebpf = [1726, 1738, 1716, 1708, 1730, 1713];

        // Whole application overhead data
        const baseline_wall_s = [3.504, 8.257, 8.459, 2.637, 3.467, 2.503];
        const lttng_wall_s = [3.643, 8.105, 8.396, 2.668, 3.5749999999999997, 2.574];
        const ebpf_wall_s = [5.631, 10.686, 9.916, 2.858, 3.661, 2.5469999999999997];
        const lttng_app_overhead_pct = [3.9668949771689332, -1.8408622986556766, -0.7447688852110002, 1.175578308684111, 3.1150850879722913, 2.8365960846983507];
        const ebpf_app_overhead_pct = [60.702054794520556, 29.417463969964874, 17.22425818654689, 8.38073568448996, 5.5956158061724715, 1.7578905313623494];

        // Color scheme: LTTng = orange, eBPF = blue, Baseline = gray
        const colors = {
            baseline: '#7f8c8d',
            lttng: '#e67e22',
            ebpf: '#3498db'
        };

        // Overhead percentage chart
        const overheadData = [
            {
                x: work_us_data,
                y: lttng_overhead_pct,
                name: 'LTTng',
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 10, color: colors.lttng },
                line: { width: 3, color: colors.lttng }
            },
            {
                x: work_us_data,
                y: ebpf_overhead_pct,
                name: 'eBPF',
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 10, color: colors.ebpf },
                line: { width: 3, color: colors.ebpf }
            }
        ];

        const overheadLayout = {
            title: 'Relative Overhead vs Function Duration',
            xaxis: {
                title: 'Simulated Work Duration (Œºs)',
                type: 'category'
            },
            yaxis: {
                title: 'Overhead (%)',
                zeroline: true
            },
            hovermode: 'closest',
            height: 500
        };

        Plotly.newPlot('overhead-chart', overheadData, overheadLayout);

        // Whole application overhead percentage chart
        const appOverheadData = [
            {
                x: work_us_data,
                y: lttng_app_overhead_pct,
                name: 'LTTng',
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 10, color: colors.lttng },
                line: { width: 3, color: colors.lttng }
            },
            {
                x: work_us_data,
                y: ebpf_app_overhead_pct,
                name: 'eBPF',
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 10, color: colors.ebpf },
                line: { width: 3, color: colors.ebpf }
            }
        ];

        const appOverheadLayout = {
            title: 'Whole Application Overhead vs Function Duration',
            xaxis: {
                title: 'Simulated Work Duration (Œºs)',
                type: 'category'
            },
            yaxis: {
                title: 'Total Application Overhead (%)',
                zeroline: true
            },
            hovermode: 'closest',
            height: 500
        };

        Plotly.newPlot('app-overhead-chart', appOverheadData, appOverheadLayout);

        // Wall time comparison chart - grouped bars showing total execution time
        const wallTimeData = [
            {
                x: scenario_names,
                y: baseline_wall_s,
                name: 'Baseline',
                type: 'bar',
                marker: { color: colors.baseline }
            },
            {
                x: scenario_names,
                y: lttng_wall_s,
                name: 'LTTng',
                type: 'bar',
                marker: { color: colors.lttng }
            },
            {
                x: scenario_names,
                y: ebpf_wall_s,
                name: 'eBPF',
                type: 'bar',
                marker: { color: colors.ebpf }
            }
        ];

        const wallTimeLayout = {
            title: 'Total Execution Time Comparison',
            xaxis: { title: 'Scenario' },
            yaxis: {
                title: 'Wall Clock Time (seconds)',
                type: 'log'
            },
            barmode: 'group',
            height: 500
        };

        Plotly.newPlot('wall-time-chart', wallTimeData, wallTimeLayout);

        // Absolute timing chart - grouped bars showing total time per method
        const timingData = [
            {
                x: scenario_names,
                y: baseline_ns_data,
                name: 'Baseline',
                type: 'bar',
                marker: { color: colors.baseline }
            },
            {
                x: scenario_names,
                y: lttng_total_ns,
                name: 'LTTng',
                type: 'bar',
                marker: { color: colors.lttng }
            },
            {
                x: scenario_names,
                y: ebpf_total_ns,
                name: 'eBPF',
                type: 'bar',
                marker: { color: colors.ebpf }
            }
        ];

        const timingLayout = {
            title: 'Absolute Timing Comparison',
            xaxis: { title: 'Scenario' },
            yaxis: {
                title: 'Time (nanoseconds)',
                type: 'log'
            },
            barmode: 'group',
            height: 500
        };

        Plotly.newPlot('timing-chart', timingData, timingLayout);

        // Memory usage chart
        const memoryData = [
            {
                x: scenario_names,
                y: memory_baseline,
                name: 'Baseline',
                type: 'bar',
                marker: { color: colors.baseline }
            },
            {
                x: scenario_names,
                y: memory_lttng,
                name: 'LTTng',
                type: 'bar',
                marker: { color: colors.lttng }
            },
            {
                x: scenario_names,
                y: memory_ebpf,
                name: 'eBPF',
                type: 'bar',
                marker: { color: colors.ebpf }
            }
        ];

        Plotly.newPlot('memory-chart', memoryData, {
            title: 'Memory Usage Comparison',
            xaxis: { title: 'Scenario' },
            yaxis: { title: 'Memory (KB)' },
            barmode: 'group',
            height: 400
        });
    </script>
</body>
</html>

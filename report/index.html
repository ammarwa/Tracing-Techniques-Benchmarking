<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>eBPF vs LTTng Comprehensive Benchmark Report</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        .key-finding {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .key-finding h3 {
            margin-top: 0;
            color: #856404;
        }
        .table-wrapper {
            overflow-x: auto;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            min-width: 800px;  /* Prevent table from becoming too narrow */
        }
        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            white-space: nowrap;  /* Prevent text wrapping in cells */
        }
        th {
            background: #3498db;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:hover {
            background: #f8f9fa;
        }
        td:nth-child(1), td:nth-child(2) {
            font-weight: 600;  /* Make scenario and work columns stand out */
        }
        .chart {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .metadata {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .good { color: #27ae60; font-weight: bold; }
        .warning { color: #f39c12; font-weight: bold; }
        .bad { color: #e74c3c; font-weight: bold; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä eBPF vs LTTng Comprehensive Benchmark Report</h1>

                
        <div style="background: #e8f4fd; border: 1px solid #bee5eb; border-radius: 5px; padding: 15px; margin: 20px 0;">
            <p style="margin: 0;"><strong>üîó Additional Resources:</strong> 
            <a href="full-hip-trace-benchmark/" style="color: #0066cc; text-decoration: none;">
                <strong>Full HIP Trace Benchmark Results</strong>
            </a> - Complete tracing tools comparison including eBPF, LTTng/Exatracer, and ROCProfV3, measuring wall-time overhead added to application processes in real-world HIP tracing scenarios.</p>
        </div>

        <div class="metadata">
            <strong>Generated:</strong> 2025-10-16 10:19:41<br>
            <strong>Test Scenarios:</strong> 6<br>
            <strong>Function Durations Tested:</strong> 0 Œºs (empty) to 1000 Œºs<br>
            <strong>Runs Per Scenario:</strong> 20 (for statistical reliability)<br>
            <strong>Total Tests Run:</strong> 360
        </div>

        <div class="key-finding">
            <h3>üîë Key Finding: Understanding Per-Call vs Whole Application Overhead</h3>
            <p>eBPF uprobe overhead is approximately <strong>~5 microseconds per function call</strong>, regardless of function duration.</p>

            <p><strong>Per-Call Overhead (Individual Function):</strong></p>
            <ul>
                <li>For nanosecond functions: Overhead appears catastrophic (1000x+)</li>
                <li>For microsecond functions: Overhead is moderate (1-10x)</li>
                <li>For millisecond functions: Overhead is negligible (&lt;1%)</li>
            </ul>

            <p><strong>Whole Application Overhead (Total Execution Time):</strong></p>
            <ul>
                <li>This is what matters in production!</li>
                <li>Measured as the increase in total wall clock time</li>
                <li>Includes all traced calls plus application overhead</li>
                <li>Typically much lower than per-call overhead averages</li>
            </ul>

            <p><strong>Conclusion:</strong> eBPF is perfect for GPU tracing where HIP API calls typically take 10-1000 Œºs! The whole application overhead is typically &lt;5% for realistic workloads.</p>
        </div>

        <h2>üìà Per-Call Overhead by Function Duration</h2>
        <p><em>This chart shows the overhead added to each individual function call.</em></p>
        <div class="chart" id="overhead-chart"></div>

        <h2>üåê Whole Application Overhead</h2>
        <p><em>This chart shows the total overhead impact on the entire application execution time (wall clock time).</em></p>
        <div class="chart" id="app-overhead-chart"></div>

        <h2>‚è±Ô∏è Total Execution Time Comparison</h2>
        <p><em>This chart compares the absolute wall clock time for the entire application run.</em></p>
        <div class="chart" id="wall-time-chart"></div>

        <h2>‚è±Ô∏è Per-Call Timing Comparison</h2>
        <p><em>This chart shows the average time per individual function call.</em></p>
        <div class="chart" id="timing-chart"></div>

        <h2>üìä Detailed Results Table</h2>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Work (Œºs)</th>
                        <th>Method</th>
                        <th>Wall Time (s)</th>
                        <th>App Overhead %</th>
                        <th>Avg Time/Call (ns)</th>
                        <th>¬±95% CI</th>
                        <th>Per-Call Overhead %</th>
                        <th>CPU (s)</th>
                        <th>Memory (KB)</th>
                    </tr>
                </thead>
                <tbody>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>Empty Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">0</td>
                    <td><strong>Baseline</strong></td>
                    <td>0.000</td>
                    <td class="good">0%</td>
                    <td>5.06</td>
                    <td><small>¬±0.51</small></td>
                    <td class="good">0%</td>
                    <td>0.000</td>
                    <td>1,719</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>0.090</td>
                    <td class="good">0.0%</td>
                    <td>289.11</td>
                    <td><small>¬±13.76</small></td>
                    <td class="bad">5615.3%</td>
                    <td>0.083</td>
                    <td>337,148</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>5.025</td>
                    <td class="good">0.0%</td>
                    <td>50285.63</td>
                    <td><small>¬±12748.39</small></td>
                    <td class="bad">993981.8%</td>
                    <td>5.020</td>
                    <td>1,734 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>5 Œºs Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">5</td>
                    <td><strong>Baseline</strong></td>
                    <td>9.888</td>
                    <td class="good">0%</td>
                    <td>98911.88</td>
                    <td><small>¬±1085.04</small></td>
                    <td class="good">0%</td>
                    <td>9.883</td>
                    <td>1,756</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>9.270</td>
                    <td class="good">-6.2%</td>
                    <td>92157.10</td>
                    <td><small>¬±1149.97</small></td>
                    <td class="good">-6.8%</td>
                    <td>9.261</td>
                    <td>337,044</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>14.662</td>
                    <td class="warning">48.3%</td>
                    <td>146657.38</td>
                    <td><small>¬±10831.64</small></td>
                    <td class="warning">48.3%</td>
                    <td>14.656</td>
                    <td>1,720 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>50 Œºs Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">50</td>
                    <td><strong>Baseline</strong></td>
                    <td>11.268</td>
                    <td class="good">0%</td>
                    <td>225402.19</td>
                    <td><small>¬±3284.75</small></td>
                    <td class="good">0%</td>
                    <td>11.262</td>
                    <td>1,709</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>11.322</td>
                    <td class="good">0.5%</td>
                    <td>225385.75</td>
                    <td><small>¬±5028.19</small></td>
                    <td class="good">-0.0%</td>
                    <td>11.315</td>
                    <td>337,014</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>14.221</td>
                    <td class="warning">26.2%</td>
                    <td>284473.96</td>
                    <td><small>¬±12673.72</small></td>
                    <td class="warning">26.2%</td>
                    <td>14.215</td>
                    <td>1,722 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>100 Œºs Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">100</td>
                    <td><strong>Baseline</strong></td>
                    <td>3.614</td>
                    <td class="good">0%</td>
                    <td>361730.38</td>
                    <td><small>¬±5624.23</small></td>
                    <td class="good">0%</td>
                    <td>3.609</td>
                    <td>1,752</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>3.610</td>
                    <td class="good">-0.1%</td>
                    <td>356241.55</td>
                    <td><small>¬±3777.18</small></td>
                    <td class="good">-1.5%</td>
                    <td>3.601</td>
                    <td>337,021</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>4.064</td>
                    <td class="warning">12.5%</td>
                    <td>406655.63</td>
                    <td><small>¬±15548.29</small></td>
                    <td class="warning">12.4%</td>
                    <td>4.056</td>
                    <td>1,727 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>500 Œºs Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">500</td>
                    <td><strong>Baseline</strong></td>
                    <td>4.207</td>
                    <td class="good">0%</td>
                    <td>842049.32</td>
                    <td><small>¬±9514.86</small></td>
                    <td class="good">0%</td>
                    <td>4.202</td>
                    <td>1,722</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>4.332</td>
                    <td class="good">3.0%</td>
                    <td>856396.99</td>
                    <td><small>¬±11423.09</small></td>
                    <td class="good">1.7%</td>
                    <td>4.325</td>
                    <td>337,077</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>4.550</td>
                    <td class="good">8.2%</td>
                    <td>910758.90</td>
                    <td><small>¬±16505.52</small></td>
                    <td class="good">8.2%</td>
                    <td>4.544</td>
                    <td>1,730 (app)</td>
                </tr>

                <tr>
                    <td rowspan="3" style="vertical-align: middle;"><strong>1000 Œºs (1ms) Function</strong></td>
                    <td rowspan="3" style="vertical-align: middle;">1000</td>
                    <td><strong>Baseline</strong></td>
                    <td>2.900</td>
                    <td class="good">0%</td>
                    <td>1452098.95</td>
                    <td><small>¬±7505.70</small></td>
                    <td class="good">0%</td>
                    <td>2.896</td>
                    <td>1,727</td>
                </tr>

                <tr>
                    <td>LTTng</td>
                    <td>2.985</td>
                    <td class="good">2.9%</td>
                    <td>1468480.02</td>
                    <td><small>¬±7858.35</small></td>
                    <td class="good">1.1%</td>
                    <td>2.979</td>
                    <td>337,060</td>
                </tr>

                <tr>
                    <td>eBPF</td>
                    <td>3.025</td>
                    <td class="good">4.3%</td>
                    <td>1514205.45</td>
                    <td><small>¬±12137.27</small></td>
                    <td class="good">4.3%</td>
                    <td>3.021</td>
                    <td>1,738 (app)</td>
                </tr>

                </tbody>
            </table>
        </div>

        <h2>üíæ Resource Usage Comparison</h2>
        <div class="chart" id="memory-chart"></div>

        <h2>üìù Analysis and Recommendations</h2>

        <h3>When to Use Each Method</h3>
        <table>
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Best For</th>
                    <th>Avoid When</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>LTTng</strong></td>
                    <td>
                        ‚Ä¢ Functions > 100ns<br>
                        ‚Ä¢ Can modify app or use LD_PRELOAD<br>
                        ‚Ä¢ Need rich userspace context<br>
                        ‚Ä¢ High call frequency (>10K/sec)
                    </td>
                    <td>
                        ‚Ä¢ Cannot modify application<br>
                        ‚Ä¢ Need kernel-level tracing<br>
                        ‚Ä¢ Want dynamic attach/detach
                    </td>
                </tr>
                <tr>
                    <td><strong>eBPF</strong></td>
                    <td>
                        ‚Ä¢ Functions > 10Œºs<br>
                        ‚Ä¢ Cannot modify application<br>
                        ‚Ä¢ Need kernel visibility<br>
                        ‚Ä¢ Want dynamic attach/detach<br>
                        ‚Ä¢ GPU/HIP API tracing
                    </td>
                    <td>
                        ‚Ä¢ Ultra-fast functions (<1Œºs)<br>
                        ‚Ä¢ Very high frequency (>1M calls/sec)<br>
                        ‚Ä¢ Need real-time streaming
                    </td>
                </tr>
            </tbody>
        </table>

        <h3>GPU/HIP Tracing Recommendation</h3>
        <p>For GPU and HIP API tracing, <strong>eBPF is highly recommended</strong> because:</p>
        <ul>
            <li>HIP API calls typically take 10-1000 Œºs (much slower than uprobe overhead)</li>
            <li>Slow API calls can take milliseconds (making tracer overhead negligible)</li>
            <li>No application modification required (zero code changes)</li>
            <li>Can trace at kernel/driver boundary for complete visibility</li>
            <li>Expected total application overhead: <strong>&lt;1%</strong></li>
        </ul>

        <h2>üìö Data Files</h2>
        <p>Raw benchmark data: <code>benchmark_results_20251016_092403/results.json</code></p>
        <p><em>Note: Individual trace files are automatically cleaned up after data extraction to minimize disk usage.</em></p>
    </div>

    <script>
        // Prepare data for charts
        const work_us_data = [0, 5, 50, 100, 500, 1000];
        const lttng_overhead_pct = [5615.330631610161, -6.829089587179682, -0.007292520062507357, -1.5173815181677042, 1.7039000243068925, 1.1280964029732221];
        const ebpf_overhead_pct = [993981.7633685876, 48.27074338890218, 26.20727519902415, 12.419538121492813, 8.159805096261131, 4.277015907596393];

        const scenario_names = ["Empty Function", "5 \u03bcs Function", "50 \u03bcs Function", "100 \u03bcs Function", "500 \u03bcs Function", "1000 \u03bcs (1ms) Function"];
        const baseline_ns_data = [5.0585, 98911.8815, 225402.191, 361730.3845, 842049.316, 1452098.948];
        const lttng_total_ns = [289.11, 92157.1005, 225385.7535, 356241.5545, 856396.9945, 1468480.024];
        const ebpf_total_ns = [50285.626000000004, 146657.382, 284473.9635, 406655.6275, 910758.899, 1514205.451];

        const memory_baseline = [1719, 1756, 1709, 1752, 1722, 1727];
        const memory_lttng = [337148, 337044, 337014, 337021, 337077, 337060];
        const memory_ebpf = [1734, 1720, 1722, 1727, 1730, 1738];

        // Whole application overhead data
        const baseline_wall_s = [0.0, 9.888, 11.2675, 3.6135, 4.207, 2.9];
        const lttng_wall_s = [0.0905, 9.27, 11.3225, 3.6095, 4.332, 2.9845];
        const ebpf_wall_s = [5.025, 14.662, 14.221, 4.064, 4.5504999999999995, 3.025];
        const lttng_app_overhead_pct = [0, -6.25, 0.4881295762147797, -0.11069600110695799, 2.9712384121701962, 2.913793103448281];
        const ebpf_app_overhead_pct = [0, 48.28074433656959, 26.212558242733518, 12.467137124671357, 8.16496315664368, 4.31034482758621];

        // Color scheme: LTTng = orange, eBPF = blue, Baseline = gray
        const colors = {
            baseline: '#7f8c8d',
            lttng: '#e67e22',
            ebpf: '#3498db'
        };

        // Overhead percentage chart
        const overheadData = [
            {
                x: work_us_data,
                y: lttng_overhead_pct,
                name: 'LTTng',
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 10, color: colors.lttng },
                line: { width: 3, color: colors.lttng }
            },
            {
                x: work_us_data,
                y: ebpf_overhead_pct,
                name: 'eBPF',
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 10, color: colors.ebpf },
                line: { width: 3, color: colors.ebpf }
            }
        ];

        const overheadLayout = {
            title: 'Relative Overhead vs Function Duration',
            xaxis: {
                title: 'Simulated Work Duration (Œºs)',
                type: 'category'
            },
            yaxis: {
                title: 'Overhead (%)',
                zeroline: true
            },
            hovermode: 'closest',
            height: 500
        };

        Plotly.newPlot('overhead-chart', overheadData, overheadLayout);

        // Whole application overhead percentage chart
        const appOverheadData = [
            {
                x: work_us_data,
                y: lttng_app_overhead_pct,
                name: 'LTTng',
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 10, color: colors.lttng },
                line: { width: 3, color: colors.lttng }
            },
            {
                x: work_us_data,
                y: ebpf_app_overhead_pct,
                name: 'eBPF',
                type: 'scatter',
                mode: 'lines+markers',
                marker: { size: 10, color: colors.ebpf },
                line: { width: 3, color: colors.ebpf }
            }
        ];

        const appOverheadLayout = {
            title: 'Whole Application Overhead vs Function Duration',
            xaxis: {
                title: 'Simulated Work Duration (Œºs)',
                type: 'category'
            },
            yaxis: {
                title: 'Total Application Overhead (%)',
                zeroline: true
            },
            hovermode: 'closest',
            height: 500
        };

        Plotly.newPlot('app-overhead-chart', appOverheadData, appOverheadLayout);

        // Wall time comparison chart - grouped bars showing total execution time
        const wallTimeData = [
            {
                x: scenario_names,
                y: baseline_wall_s,
                name: 'Baseline',
                type: 'bar',
                marker: { color: colors.baseline }
            },
            {
                x: scenario_names,
                y: lttng_wall_s,
                name: 'LTTng',
                type: 'bar',
                marker: { color: colors.lttng }
            },
            {
                x: scenario_names,
                y: ebpf_wall_s,
                name: 'eBPF',
                type: 'bar',
                marker: { color: colors.ebpf }
            }
        ];

        const wallTimeLayout = {
            title: 'Total Execution Time Comparison',
            xaxis: { title: 'Scenario' },
            yaxis: {
                title: 'Wall Clock Time (seconds)',
                type: 'log'
            },
            barmode: 'group',
            height: 500
        };

        Plotly.newPlot('wall-time-chart', wallTimeData, wallTimeLayout);

        // Absolute timing chart - grouped bars showing total time per method
        const timingData = [
            {
                x: scenario_names,
                y: baseline_ns_data,
                name: 'Baseline',
                type: 'bar',
                marker: { color: colors.baseline }
            },
            {
                x: scenario_names,
                y: lttng_total_ns,
                name: 'LTTng',
                type: 'bar',
                marker: { color: colors.lttng }
            },
            {
                x: scenario_names,
                y: ebpf_total_ns,
                name: 'eBPF',
                type: 'bar',
                marker: { color: colors.ebpf }
            }
        ];

        const timingLayout = {
            title: 'Absolute Timing Comparison',
            xaxis: { title: 'Scenario' },
            yaxis: {
                title: 'Time (nanoseconds)',
                type: 'log'
            },
            barmode: 'group',
            height: 500
        };

        Plotly.newPlot('timing-chart', timingData, timingLayout);

        // Memory usage chart
        const memoryData = [
            {
                x: scenario_names,
                y: memory_baseline,
                name: 'Baseline',
                type: 'bar',
                marker: { color: colors.baseline }
            },
            {
                x: scenario_names,
                y: memory_lttng,
                name: 'LTTng',
                type: 'bar',
                marker: { color: colors.lttng }
            },
            {
                x: scenario_names,
                y: memory_ebpf,
                name: 'eBPF',
                type: 'bar',
                marker: { color: colors.ebpf }
            }
        ];

        Plotly.newPlot('memory-chart', memoryData, {
            title: 'Memory Usage Comparison',
            xaxis: { title: 'Scenario' },
            yaxis: { title: 'Memory (KB)' },
            barmode: 'group',
            height: 400
        });
    </script>
</body>
</html>
